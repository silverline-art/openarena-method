# EXMO Gait Analysis Pipeline - Batch Processing Configuration
# Version: 1.0.0
# Date: 2025-11-21

# ═════════════════════════════════════════════════════════════════════════════
# GLOBAL SETTINGS
# ═════════════════════════════════════════════════════════════════════════════

input_dir: "/home/shivam/Desktop/Rodent_PE/analysis/Exmo-Open/Data"
output_dir: "/home/shivam/Desktop/Rodent_PE/analysis/Exmo-Open/Output"

# Global processing parameters
global_settings:
  fps: 120.0                        # Frame rate (Hz)
  expected_body_length_cm: 8.0      # Mouse body length for scaling
  scaling_tolerance: 0.20           # ±20% tolerance for scaling validation

  # Preprocessing
  smoothing_window: 11              # Savitzky-Golay filter window
  smoothing_poly: 3                 # Polynomial order for smoothing
  outlier_threshold: 3.0            # MAD threshold for outlier detection
  max_interpolation_gap: 5          # Maximum gap size for interpolation (frames)

  # Phase detection - ADJUSTED FOR BETTER DETECTION
  stationary_mad_threshold: 1.0     # MAD multiplier for stationary detection (lowered from 1.5)
  walking_mad_threshold: 1.2        # MAD multiplier for walking detection (lowered from 2.0)
  min_walking_duration: 0.2         # Minimum walking duration (seconds) (lowered from 0.3)
  min_stationary_duration: 0.15     # Minimum stationary duration (seconds) (lowered from 0.25)
  smoothing_window_ms: 250.0        # Phase smoothing window (milliseconds)
  merge_gap_ms: 100.0               # Gap size for merging windows (milliseconds)

  # Step detection - ADJUSTED FOR BETTER DETECTION
  min_stride_duration: 0.05         # Minimum stride duration (seconds) (lowered from 0.1 - v1.2.0 value)
  max_stride_duration: 1.5          # Maximum stride duration (seconds) (increased from 1.0)
  prominence_multiplier: 0.3        # Peak prominence multiplier for step detection (lowered from 0.5)

  # Validation - RELAXED FOR BETTER DETECTION
  min_valid_data_ratio: 0.5         # Minimum ratio of valid (non-NaN) data (lowered from 0.7)
  min_strides_required: 2           # Minimum strides for metric computation (lowered from 3)

  # Output
  plot_dpi: 300                     # Resolution for PNG plots
  verbose: true                     # Enable verbose logging

# ═════════════════════════════════════════════════════════════════════════════
# BATCH PROCESSING CONFIGURATION
# ═════════════════════════════════════════════════════════════════════════════

# Experiment groups for organized output
experiment_groups:
  control:
    description: "Control group (0 Gy radiation)"
    samples:
      - control-1
      - control-2
      - control-3
      - control_4
      - control_5
      - control_6
      - control_7

  low_dose_01:
    description: "Low dose group (0.1 Gy radiation)"
    samples:
      - 0.1grade_1
      - 0.1grade_2
      - 0.1grade_3
      - 0.1grade_4
      - 0.1grade_5
      - 0.1grade_6
      - 0.1grade_7
      - 0.1grade_8

  medium_dose_1:
    description: "Medium dose group (1 Gy radiation)"
    samples:
      - 1grade_1
      - 1grade_2
      - 1grade_3
      - 1grade_4
      - 1grade_5
      - 1grade_6
      - 1grade_7
      - 1grade_8
      - 1grade_9

  high_dose_5:
    description: "High dose group (5 Gy radiation)"
    samples:
      - 5_grade_1
      - 5_grade_2
      - 5_grade_3
      - 5_grade_4
      - 5_grade_5
      - 5_grade_6
      - 5_grade_7
      - 5_grade_8
      - 5_grade_9

# ═════════════════════════════════════════════════════════════════════════════
# FILE NAMING PATTERNS
# ═════════════════════════════════════════════════════════════════════════════

# Template for matching CSV files
# Variables: {view}, {sample_id}
file_patterns:
  top: "Top_{prefix}open_{sample_id}_*.csv"
  side: "Side_{prefix}open_{sample_id}_*.csv"
  bottom: "Bottom_{prefix}open_{sample_id}_*.csv"

# Prefix variations to try (case-insensitive matching)
prefix_variations:
  - "Irradiated_"
  - "irradiated_"
  - ""

# ═════════════════════════════════════════════════════════════════════════════
# OUTPUT ORGANIZATION
# ═════════════════════════════════════════════════════════════════════════════

# Output directory structure
# {output_dir}/{group_name}/{sample_id}/
output_structure:
  create_group_folders: true        # Create subdirectories by experiment group
  create_sample_folders: true       # Create subdirectories by sample ID

# Output file naming
# Variables: {sample_id}, {timestamp}, {group_name}
output_naming:
  xlsx: "Gait_Analysis_{sample_id}_{timestamp}.xlsx"
  plots:
    coordination: "plot_coordination_{sample_id}.png"
    speed_spatial: "plot_speed_spatial_{sample_id}.png"
    phase_timing: "plot_phase_timing_{sample_id}.png"
    range_of_motion: "plot_range_of_motion_{sample_id}.png"
  logs:
    analysis: "analysis_log_{sample_id}_{timestamp}.txt"

# ═════════════════════════════════════════════════════════════════════════════
# BATCH PROCESSING OPTIONS
# ═════════════════════════════════════════════════════════════════════════════

batch_processing:
  parallel_jobs: 4                  # Number of parallel processing jobs
  continue_on_error: true           # Continue processing if one sample fails
  generate_summary_report: true     # Generate cross-sample summary

# Summary report options
summary_report:
  compare_groups: true              # Generate group comparison statistics
  include_plots: true               # Include aggregate visualization
  export_format: "xlsx"             # Format: xlsx, csv, or both
  output_filename: "Batch_Summary_Report_{timestamp}.xlsx"

# ═════════════════════════════════════════════════════════════════════════════
# SAMPLE-SPECIFIC OVERRIDES (Optional)
# ═════════════════════════════════════════════════════════════════════════════

# Override global settings for specific samples
sample_overrides:
  1grade_3:
    # Example: Different parameters for specific challenging sample
    smoothing_window: 15
    outlier_threshold: 4.0
    notes: "Higher smoothing for noisy tracking data"

# ═════════════════════════════════════════════════════════════════════════════
# QUALITY CONTROL FLAGS
# ═════════════════════════════════════════════════════════════════════════════

quality_control:
  enable_validation: true           # Run validation checks
  fail_on_missing_keypoints: false  # Continue if some keypoints missing
  fail_on_low_quality: false        # Continue if data quality < threshold
  generate_qc_report: true          # Generate QC summary per sample

# Data quality thresholds
quality_thresholds:
  min_frames: 100                   # Minimum frame count
  min_duration_sec: 1.0             # Minimum recording duration
  min_keypoint_completeness: 0.5    # Minimum valid data per keypoint
  max_outlier_ratio: 0.3            # Maximum outlier ratio

# ═════════════════════════════════════════════════════════════════════════════
# ADVANCED OPTIONS
# ═════════════════════════════════════════════════════════════════════════════

advanced:
  save_intermediate_data: true      # Save preprocessed trajectories
  save_debug_plots: false           # Save additional diagnostic plots
  compress_output: false            # Compress output files (gzip)
  memory_efficient_mode: false      # Use streaming for large files

# Logging configuration
logging:
  level: "INFO"                     # DEBUG, INFO, WARNING, ERROR
  console_output: true              # Print to console
  file_output: true                 # Save to log files
  log_format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"

# ═════════════════════════════════════════════════════════════════════════════
# NOTES
# ═════════════════════════════════════════════════════════════════════════════

# Usage Examples:
#
# 1. Process single sample:
#    exmo_gait_analyzer --config config.yaml --sample 1grade_3
#
# 2. Process entire group:
#    exmo_gait_analyzer --config config.yaml --group medium_dose_1
#
# 3. Process all samples:
#    exmo_gait_analyzer --config config.yaml --batch
#
# 4. Generate summary report only:
#    exmo_gait_analyzer --config config.yaml --summary-only
